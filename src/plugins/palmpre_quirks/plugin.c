/* plugin.c generated by valac 0.14.2, the Vala compiler
 * generated from plugin.vala, do not modify */

/*
 * Copyright (C) 2010 Simon Busch <morphis@gravedo.de>
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.

 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.

 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301  USA
 *
 */

#include <glib.h>
#include <glib-object.h>
#include <stdlib.h>
#include <string.h>
#include <fsobasics.h>
#include <fsoresource.h>
#include <fsoframework.h>


#define PALM_PRE_TYPE_POWER_SUPPLY (palm_pre_power_supply_get_type ())
#define PALM_PRE_POWER_SUPPLY(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), PALM_PRE_TYPE_POWER_SUPPLY, PalmPrePowerSupply))
#define PALM_PRE_POWER_SUPPLY_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), PALM_PRE_TYPE_POWER_SUPPLY, PalmPrePowerSupplyClass))
#define PALM_PRE_IS_POWER_SUPPLY(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), PALM_PRE_TYPE_POWER_SUPPLY))
#define PALM_PRE_IS_POWER_SUPPLY_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), PALM_PRE_TYPE_POWER_SUPPLY))
#define PALM_PRE_POWER_SUPPLY_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), PALM_PRE_TYPE_POWER_SUPPLY, PalmPrePowerSupplyClass))

typedef struct _PalmPrePowerSupply PalmPrePowerSupply;
typedef struct _PalmPrePowerSupplyClass PalmPrePowerSupplyClass;

#define PALM_PRE_TYPE_POWER_CONTROL (palm_pre_power_control_get_type ())
#define PALM_PRE_POWER_CONTROL(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), PALM_PRE_TYPE_POWER_CONTROL, PalmPrePowerControl))
#define PALM_PRE_POWER_CONTROL_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), PALM_PRE_TYPE_POWER_CONTROL, PalmPrePowerControlClass))
#define PALM_PRE_IS_POWER_CONTROL(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), PALM_PRE_TYPE_POWER_CONTROL))
#define PALM_PRE_IS_POWER_CONTROL_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), PALM_PRE_TYPE_POWER_CONTROL))
#define PALM_PRE_POWER_CONTROL_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), PALM_PRE_TYPE_POWER_CONTROL, PalmPrePowerControlClass))

typedef struct _PalmPrePowerControl PalmPrePowerControl;
typedef struct _PalmPrePowerControlClass PalmPrePowerControlClass;

#define PALM_PRE_TYPE_AMBIENT_LIGHT (palm_pre_ambient_light_get_type ())
#define PALM_PRE_AMBIENT_LIGHT(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), PALM_PRE_TYPE_AMBIENT_LIGHT, PalmPreAmbientLight))
#define PALM_PRE_AMBIENT_LIGHT_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), PALM_PRE_TYPE_AMBIENT_LIGHT, PalmPreAmbientLightClass))
#define PALM_PRE_IS_AMBIENT_LIGHT(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), PALM_PRE_TYPE_AMBIENT_LIGHT))
#define PALM_PRE_IS_AMBIENT_LIGHT_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), PALM_PRE_TYPE_AMBIENT_LIGHT))
#define PALM_PRE_AMBIENT_LIGHT_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), PALM_PRE_TYPE_AMBIENT_LIGHT, PalmPreAmbientLightClass))

typedef struct _PalmPreAmbientLight PalmPreAmbientLight;
typedef struct _PalmPreAmbientLightClass PalmPreAmbientLightClass;

#define PALM_PRE_TYPE_PROXIMITY (palm_pre_proximity_get_type ())
#define PALM_PRE_PROXIMITY(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), PALM_PRE_TYPE_PROXIMITY, PalmPreProximity))
#define PALM_PRE_PROXIMITY_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), PALM_PRE_TYPE_PROXIMITY, PalmPreProximityClass))
#define PALM_PRE_IS_PROXIMITY(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), PALM_PRE_TYPE_PROXIMITY))
#define PALM_PRE_IS_PROXIMITY_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), PALM_PRE_TYPE_PROXIMITY))
#define PALM_PRE_PROXIMITY_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), PALM_PRE_TYPE_PROXIMITY, PalmPreProximityClass))

typedef struct _PalmPreProximity PalmPreProximity;
typedef struct _PalmPreProximityClass PalmPreProximityClass;

#define PALM_PRE_TYPE_PROXIMITY_RESOURCE (palm_pre_proximity_resource_get_type ())
#define PALM_PRE_PROXIMITY_RESOURCE(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), PALM_PRE_TYPE_PROXIMITY_RESOURCE, PalmPreProximityResource))
#define PALM_PRE_PROXIMITY_RESOURCE_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), PALM_PRE_TYPE_PROXIMITY_RESOURCE, PalmPreProximityResourceClass))
#define PALM_PRE_IS_PROXIMITY_RESOURCE(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), PALM_PRE_TYPE_PROXIMITY_RESOURCE))
#define PALM_PRE_IS_PROXIMITY_RESOURCE_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), PALM_PRE_TYPE_PROXIMITY_RESOURCE))
#define PALM_PRE_PROXIMITY_RESOURCE_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), PALM_PRE_TYPE_PROXIMITY_RESOURCE, PalmPreProximityResourceClass))

typedef struct _PalmPreProximityResource PalmPreProximityResource;
typedef struct _PalmPreProximityResourceClass PalmPreProximityResourceClass;
#define _g_free0(var) (var = (g_free (var), NULL))
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))


extern gchar* palm_pre_sysfs_root;
gchar* palm_pre_sysfs_root = NULL;
extern gchar* palm_pre_devfs_root;
gchar* palm_pre_devfs_root = NULL;
extern PalmPrePowerSupply* power_supply;
PalmPrePowerSupply* power_supply = NULL;
extern PalmPrePowerControl* power_control;
PalmPrePowerControl* power_control = NULL;
extern PalmPreAmbientLight* ambient_light;
PalmPreAmbientLight* ambient_light = NULL;
extern PalmPreProximity* proximity;
PalmPreProximity* proximity = NULL;
extern PalmPreProximityResource* proximity_resource;
PalmPreProximityResource* proximity_resource = NULL;

#define PALM_PRE_MODULE_NAME "fsodevice.palmpre_quirks"
GType palm_pre_power_supply_get_type (void) G_GNUC_CONST;
GType palm_pre_power_supply_register_type (GTypeModule * module);
GType palm_pre_power_control_get_type (void) G_GNUC_CONST;
GType palm_pre_power_control_register_type (GTypeModule * module);
GType palm_pre_ambient_light_get_type (void) G_GNUC_CONST;
GType palm_pre_ambient_light_register_type (GTypeModule * module);
GType palm_pre_proximity_get_type (void) G_GNUC_CONST;
GType palm_pre_proximity_register_type (GTypeModule * module);
GType palm_pre_proximity_resource_get_type (void) G_GNUC_CONST;
GType palm_pre_proximity_resource_register_type (GTypeModule * module);
gchar* fso_factory_function (FsoFrameworkSubsystem* subsystem, GError** error);
PalmPrePowerSupply* palm_pre_power_supply_new (FsoFrameworkSubsystem* subsystem);
PalmPrePowerSupply* palm_pre_power_supply_construct (GType object_type, FsoFrameworkSubsystem* subsystem);
PalmPrePowerControl* palm_pre_power_control_new (FsoFrameworkSubsystem* subsystem);
PalmPrePowerControl* palm_pre_power_control_construct (GType object_type, FsoFrameworkSubsystem* subsystem);
PalmPreAmbientLight* palm_pre_ambient_light_new (FsoFrameworkSubsystem* subsystem, const gchar* sysfsnode);
PalmPreAmbientLight* palm_pre_ambient_light_construct (GType object_type, FsoFrameworkSubsystem* subsystem, const gchar* sysfsnode);
PalmPreProximity* palm_pre_proximity_new (FsoFrameworkSubsystem* subsystem, const gchar* sysfsnode);
PalmPreProximity* palm_pre_proximity_construct (GType object_type, FsoFrameworkSubsystem* subsystem, const gchar* sysfsnode);
PalmPreProximityResource* palm_pre_proximity_resource_new (FsoFrameworkSubsystem* subsystem, PalmPreProximity* instance);
PalmPreProximityResource* palm_pre_proximity_resource_construct (GType object_type, FsoFrameworkSubsystem* subsystem, PalmPreProximity* instance);
void fso_register_function (GTypeModule* module);


/**
 * This function gets called on plugin initialization time.
 * @return the name of your plugin here
 * @note that it needs to be a name in the format <subsystem>.<plugin>
 * else your module will be unloaded immediately.
 **/
static gpointer _g_object_ref0 (gpointer self) {
	return self ? g_object_ref (self) : NULL;
}


static const gchar* string_to_string (const gchar* self) {
	const gchar* result = NULL;
	g_return_val_if_fail (self != NULL, NULL);
	result = self;
	return result;
}


gchar* fso_factory_function (FsoFrameworkSubsystem* subsystem, GError** error) {
	gchar* result = NULL;
	FsoFrameworkSmartKeyFile* _tmp0_;
	FsoFrameworkSmartKeyFile* _tmp1_;
	FsoFrameworkSmartKeyFile* config;
	FsoFrameworkSmartKeyFile* _tmp2_;
	gchar* _tmp3_ = NULL;
	FsoFrameworkSmartKeyFile* _tmp4_;
	gchar* _tmp5_ = NULL;
	FsoFrameworkSmartKeyFile* _tmp6_;
	const gchar* _tmp7_ = NULL;
	gchar* _tmp8_ = NULL;
	gchar* _tmp9_;
	gboolean _tmp10_ = FALSE;
	gboolean _tmp11_;
	FsoFrameworkSmartKeyFile* _tmp14_;
	const gchar* _tmp15_ = NULL;
	gchar* _tmp16_ = NULL;
	gchar* _tmp17_;
	gboolean _tmp18_ = FALSE;
	gboolean _tmp19_;
	FsoFrameworkSmartKeyFile* _tmp22_;
	const gchar* _tmp23_ = NULL;
	gchar* _tmp24_ = NULL;
	gchar* _tmp25_;
	gboolean _tmp26_ = FALSE;
	gboolean _tmp27_;
	FsoFrameworkSmartKeyFile* _tmp36_;
	const gchar* _tmp37_ = NULL;
	gchar* _tmp38_ = NULL;
	gchar* _tmp39_;
	gboolean _tmp40_ = FALSE;
	gboolean _tmp41_;
	gchar* _tmp52_;
	g_return_val_if_fail (subsystem != NULL, NULL);
	_tmp0_ = fso_framework_theConfig;
	_tmp1_ = _g_object_ref0 (_tmp0_);
	config = _tmp1_;
	_tmp2_ = config;
	_tmp3_ = fso_framework_smart_key_file_stringValue (_tmp2_, "cornucopia", "sysfs_root", "/sys");
	_g_free0 (palm_pre_sysfs_root);
	palm_pre_sysfs_root = _tmp3_;
	_tmp4_ = config;
	_tmp5_ = fso_framework_smart_key_file_stringValue (_tmp4_, "cornucopia", "devfs_root", "/dev");
	_g_free0 (palm_pre_devfs_root);
	palm_pre_devfs_root = _tmp5_;
	_tmp6_ = config;
	_tmp7_ = string_to_string (PALM_PRE_MODULE_NAME);
	_tmp8_ = g_strconcat (_tmp7_, "/powersupply", NULL);
	_tmp9_ = _tmp8_;
	_tmp10_ = fso_framework_smart_key_file_hasSection (_tmp6_, _tmp9_);
	_tmp11_ = _tmp10_;
	_g_free0 (_tmp9_);
	if (_tmp11_) {
		FsoFrameworkSubsystem* _tmp12_;
		PalmPrePowerSupply* _tmp13_;
		_tmp12_ = subsystem;
		_tmp13_ = palm_pre_power_supply_new (_tmp12_);
		_g_object_unref0 (power_supply);
		power_supply = _tmp13_;
	}
	_tmp14_ = config;
	_tmp15_ = string_to_string (PALM_PRE_MODULE_NAME);
	_tmp16_ = g_strconcat (_tmp15_, "/powercontrol", NULL);
	_tmp17_ = _tmp16_;
	_tmp18_ = fso_framework_smart_key_file_hasSection (_tmp14_, _tmp17_);
	_tmp19_ = _tmp18_;
	_g_free0 (_tmp17_);
	if (_tmp19_) {
		FsoFrameworkSubsystem* _tmp20_;
		PalmPrePowerControl* _tmp21_;
		_tmp20_ = subsystem;
		_tmp21_ = palm_pre_power_control_new (_tmp20_);
		_g_object_unref0 (power_control);
		power_control = _tmp21_;
	}
	_tmp22_ = config;
	_tmp23_ = string_to_string (PALM_PRE_MODULE_NAME);
	_tmp24_ = g_strconcat (_tmp23_, "/ambientlight", NULL);
	_tmp25_ = _tmp24_;
	_tmp26_ = fso_framework_smart_key_file_hasSection (_tmp22_, _tmp25_);
	_tmp27_ = _tmp26_;
	_g_free0 (_tmp25_);
	if (_tmp27_) {
		const gchar* _tmp28_;
		gchar* _tmp29_ = NULL;
		gchar* dirname;
		const gchar* _tmp30_;
		gboolean _tmp31_ = FALSE;
		_tmp28_ = palm_pre_sysfs_root;
		_tmp29_ = g_build_filename (_tmp28_, "devices", "platform", "temt6200_light", "input", "input4", NULL);
		dirname = _tmp29_;
		_tmp30_ = dirname;
		_tmp31_ = fso_framework_file_handling_isPresent (_tmp30_);
		if (_tmp31_) {
			FsoFrameworkSubsystem* _tmp32_;
			const gchar* _tmp33_;
			PalmPreAmbientLight* _tmp34_;
			_tmp32_ = subsystem;
			_tmp33_ = dirname;
			_tmp34_ = palm_pre_ambient_light_new (_tmp32_, _tmp33_);
			_g_object_unref0 (ambient_light);
			ambient_light = _tmp34_;
		} else {
			FsoFrameworkLogger* _tmp35_;
			_tmp35_ = fso_framework_theLogger;
			fso_framework_logger_error (_tmp35_, "No ambient light device found; ambient light object will not be availa" \
"ble");
		}
		_g_free0 (dirname);
	}
	_tmp36_ = config;
	_tmp37_ = string_to_string (PALM_PRE_MODULE_NAME);
	_tmp38_ = g_strconcat (_tmp37_, "/proximity", NULL);
	_tmp39_ = _tmp38_;
	_tmp40_ = fso_framework_smart_key_file_hasSection (_tmp36_, _tmp39_);
	_tmp41_ = _tmp40_;
	_g_free0 (_tmp39_);
	if (_tmp41_) {
		const gchar* _tmp42_;
		gchar* _tmp43_ = NULL;
		gchar* dirname;
		const gchar* _tmp44_;
		gboolean _tmp45_ = FALSE;
		_tmp42_ = palm_pre_sysfs_root;
		_tmp43_ = g_build_filename (_tmp42_, "devices", "platform", "hsdl9100_proximity", "input", "input3", NULL);
		dirname = _tmp43_;
		_tmp44_ = dirname;
		_tmp45_ = fso_framework_file_handling_isPresent (_tmp44_);
		if (_tmp45_) {
			FsoFrameworkSubsystem* _tmp46_;
			const gchar* _tmp47_;
			PalmPreProximity* _tmp48_;
			FsoFrameworkSubsystem* _tmp49_;
			PalmPreProximity* _tmp50_;
			PalmPreProximityResource* _tmp51_;
			_tmp46_ = subsystem;
			_tmp47_ = dirname;
			_tmp48_ = palm_pre_proximity_new (_tmp46_, _tmp47_);
			_g_object_unref0 (proximity);
			proximity = _tmp48_;
			_tmp49_ = subsystem;
			_tmp50_ = proximity;
			_tmp51_ = palm_pre_proximity_resource_new (_tmp49_, _tmp50_);
			_g_object_unref0 (proximity_resource);
			proximity_resource = _tmp51_;
		}
		_g_free0 (dirname);
	}
	_tmp52_ = g_strdup (PALM_PRE_MODULE_NAME);
	result = _tmp52_;
	_g_object_unref0 (config);
	return result;
}


void fso_register_function (GTypeModule* module) {
	FsoFrameworkLogger* _tmp0_;
	g_return_if_fail (module != NULL);
	palm_pre_token_lib_register_type (module);
	palm_pre_usb_gadget_listener_register_type (module);
	palm_pre_usb_gadget_power_supply_register_type (module);
	palm_pre_battery_power_supply_register_type (module);
	palm_pre_power_supply_register_type (module);
	palm_pre_wifi_power_control_register_type (module);
	palm_pre_hci_over_hsuart_transport_register_type (module);
	palm_pre_bluetooth_power_control_register_type (module);
	palm_pre_power_control_register_type (module);
	palm_pre_ambient_light_register_type (module);
	palm_pre_proximity_register_type (module);
	palm_pre_proximity_resource_register_type (module);
	_tmp0_ = fso_framework_theLogger;
	fso_framework_logger_debug (_tmp0_, "fsodevice.palmpre_quirks fso_register_function()");
}



